<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS files -->
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/main.css">

  <link rel="canonical" href="/articles/2016-06/cpanel-fun">
  <link rel="alternate" type="application/rss+xml" title="Mrwhal3's Blog" href=" /feed.xml " />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="/favicon.png">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7736525253699078",
    enable_page_level_ads: true
  });
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43857428-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Fun with cPanel - Mrwhal3’s Blog</title>
<meta property="og:title" content="Fun with cPanel" />
<meta name="description" content="Lots of Fun with Cpanel and custom php sites" />
<meta property="og:description" content="Lots of Fun with Cpanel and custom php sites" />
<link rel="canonical" href="http://www.mrwhal3.com/articles/2016-06/cpanel-fun" />
<meta property="og:url" content="http://www.mrwhal3.com/articles/2016-06/cpanel-fun" />
<meta property="og:site_name" content="Mrwhal3’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-06-17T10:00:00+10:00" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Fun with cPanel",
"datePublished": "2016-06-17T10:00:00+10:00",
"description": "Lots of Fun with Cpanel and custom php sites",
"url": "http://www.mrwhal3.com/articles/2016-06/cpanel-fun"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
        

<div class="cover-card table-cell table-middle">
  
  <img src="http://www.mrwhal3.com/img/avatar.jpg" alt="" class="avatar">
  
  <a href="http://www.mrwhal3.com/" class="author_name">Harry</a>
  <span class="author_job">Systems Administrator</span>
  <span class="author_bio mbm">Tech enthusiast, hacker of homeautomation</span>
  <nav class="nav">
    <ul class="nav-list">
       
      <li class="nav-item">
        <a href="http://www.mrwhal3.com/archive/">Archive</a>
        <span>/</span>
      </li>
          
      <li class="nav-item">
        <a href="http://www.mrwhal3.com/categories/">Categories</a>
        <span>/</span>
      </li>
            
      <li class="nav-item">
        <a href="http://www.mrwhal3.com/tags/">Tags</a>
      </li>
       
    </ul>
  </nav>
  <script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
    
    
    
    
    
    
    
    <li><a href="http://github.com/mrwhale" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
<li><a href="http://blog.mrwhal3.com/feed.xml" class="social-link-item">RSS</a></li>
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        <a class="btn" href= "http://www.mrwhal3.com/" >
  Home
</a>



<div id="post">
  <header class="post-header">
    <h1 title="Fun with cPanel">Fun with cPanel</h1>
    <span class="post-meta">
      <span class="post-date">
        17 JUN 2016
      </span>
      •
      <span class="read-time" title="Estimated read time">
  
  
    3 mins read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <p>Recently have had to set up a few cPanel servers, and here are some things I ran into while doing so. One isn’t necessarily cPanels fault, but it still took me a long time to find a work around for it :/</p>

<h4 id="key-based-login-for-ssh">Key based login for SSH</h4>

<p>Common practice for most cloud provides these days is to give you a VM with password based authentication turned off. That’s cool with me as this is one of the first things I do anyway. Setting up cPanel a breeze. Create a new user, no worries. Create SSH keys and import, easy. Attempt to login server: <code class="highlighter-rouge">login limit exceeded for account</code></p>

<p>Odd.. but let’s turn on verbose.</p>

<p>Ah it’s giving other keys before the one it needs. Let’s add <code class="highlighter-rouge">IdentitiesOnly yes</code> to config file</p>

<p>Still not working. Let’s try super verbose. Still no luck. 30 odd minutes of faffing about I decide to check the server logs (Note: check these first, not after)</p>

<p>Ah there is the real problem, server is complaining about permission issues being bad on .ssh folder for user</p>

<p><code class="highlighter-rouge">Chmod</code> that up and fixed!</p>

<h4 id="cpanel-and-aws-ec2">cPanel and aws ec2</h4>

<p>Make sure you check NAT settings! Spun up a fresh VM, added an account but it wouldn’t work! Kept redirecting me to that default “no site here” page. Tried this that and the other, but still not working</p>

<p>Turns out cPanel hadn’t detected the NAT settings properly, so didn’t have the right elastic IP (and in fact had the wrong internal IP) in its settings. To fix run <code class="highlighter-rouge">/scripts/build_cpnat</code></p>

<p>Check (settings -&gt; IP) to make sure it’s all better</p>

<h4 id="getting-custom-sites-into-cpanel">Getting custom sites into cPanel</h4>

<p>Got a site that was developed by someone else, and from the looks of it was just setup on a LAMP server, nothing special, but had real trouble trying to squash this into cPanel. Site was built on the zend framework and use composer as dependency manager. Now this would have been nice to know before I started</p>

<p>Copy site files into <code class="highlighter-rouge">public_html</code>. No thanks. Zend uses another folder <code class="highlighter-rouge">public</code> where it stores the index.php etc. That’s cool, let’s just change document root in <code class="highlighter-rouge">/var/cPanel/userdata/user/site-name</code> have to do this because there are other folders on the same level as this public folder that it uses</p>

<h5 id="note">Note</h5>
<p>There are other ways around this, using symlinks or htaccess. Probably better practice. But php</p>

<h4 id="composer-and-cpanel">Composer and cpanel</h4>
<p>The next issue I ran into was getting composer running, to build and make sure dependacies are there. Composer in cPanel? Sure why not</p>

<p><code class="highlighter-rouge">cd</code> to your public dir, or whereever your composer.json file is, <code class="highlighter-rouge">wget https://getcomposer.org/download/1.1.1/composer.phar</code> (or lookup the composer site to get the latest, and then <code class="highlighter-rouge">php composer.phar install</code></p>

<p>Surprisingly was as simple as this!</p>

<p>All good? Almost. Get slapped with this error:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ZendMailProtocol_Exception' with message '535 Incorrect authentication data ' in /Zend/Mail/Protocol/Abstract.php:378 
</code></pre>
</div>

<p><em>Sigh</em></p>

<p>Turns out Zend doesn’t play ball with exim or any other mail agent you have installed, and tried to send email by itself. So you need to enable (or disable) a setting within cpanel to get it working
Probably not the most security best practice setting to be playing with, but I needed to get it working</p>

<ol>
  <li>Login to WHM</li>
  <li>Under Server Configuration, select Tweak Settings</li>
  <li>Click on the Mail tab</li>
  <li>Scroll down to “Restrict outgoing SMTP to root, exim, and mailman (FKA SMTP Tweak)” and make sure it’s set to “OFF”</li>
  <li>Scroll to the bottom of the page and click Save</li>
</ol>


  </article>
</div>


<!-- div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://www.mrwhal3.com/articles/2016-06/cpanel-fun" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.mrwhal3.com/articles/2016-06/cpanel-fun" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://www.mrwhal3.com/articles/2016-06/cpanel-fun" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=http://www.mrwhal3.com/articles/2016-06/cpanel-fun" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=http://www.mrwhal3.com/articles/2016-06/cpanel-fun" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
</ul>
</div --> <!-- end share-buttons -->



        <footer>
  &copy; 2017 Harry. Powered by <a href="http://jekyllrb.com/">Jekyll</a>, <a href="http://github.com/renyuanz/leonids/">leonids theme</a> made with <i class="fa fa-heart heart-icon"></i>
</footer>

      </div>
    </div>
  </div>
</body>
</html>
